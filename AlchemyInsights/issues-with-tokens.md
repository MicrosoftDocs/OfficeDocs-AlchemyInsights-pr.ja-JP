---
title: トークンに関する問題
ms.author: v-smandalika
author: v-smandalika
manager: dansimp
ms.date: 01/15/2021
ms.audience: Admin
ms.topic: article
ms.service: o365-administration
ROBOTS: NOINDEX, NOFOLLOW
localization_priority: Priority
ms.collection: Adm_O365
ms.custom:
- "7774"
- "9004351"
ms.openlocfilehash: 14a9681c08920094813497e7a75eb87bb0733cbc
ms.sourcegitcommit: e378232f4c9ef4e962208100db752221e7bd2dd6
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/20/2021
ms.locfileid: "49917280"
---
# <a name="issues-with-tokens"></a><span data-ttu-id="06b37-102">トークンに関する問題</span><span class="sxs-lookup"><span data-stu-id="06b37-102">Issues with tokens</span></span>

<span data-ttu-id="06b37-103">トークンに関する問題を管理するには、次の手順を実行します。</span><span class="sxs-lookup"><span data-stu-id="06b37-103">To manage issues related to tokens, you can perform the following steps:</span></span>

1. <span data-ttu-id="06b37-104">Microsoft ID プラットフォームによって発行されるアクセス、ID、または SAML トークンの有効期限を指定できます。</span><span class="sxs-lookup"><span data-stu-id="06b37-104">You can specify the lifetime of an access, ID, or SAML token issued by Microsoft identity platform.</span></span> <span data-ttu-id="06b37-105">組織のすべてのアプリ、マルチテナント (多組織) アプリケーション、組織の特定のサービス プリンシパルにトークンの有効期間を設定できます。</span><span class="sxs-lookup"><span data-stu-id="06b37-105">You can set token lifetimes for all apps in your organization, for a multi-tenant (multi-organization) application, or for a specific service principal in your organization.</span></span> <span data-ttu-id="06b37-106">詳細については、「[Microsoft ID プラットフォームで構成可能なトークンの有効期限 (プレビュー)](https://docs.microsoft.com/azure/active-directory/develop/active-directory-configurable-token-lifetimes)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="06b37-106">For more information, see [Configurable token lifetimes in Microsoft identity platform (preview)](https://docs.microsoft.com/azure/active-directory/develop/active-directory-configurable-token-lifetimes).</span></span>
2. <span data-ttu-id="06b37-107">アクセス トークンを使用すると、クライアントは保護された Web API を安全に呼び出すことができ、Web API は認証および認可を実行するために使用します。</span><span class="sxs-lookup"><span data-stu-id="06b37-107">Access tokens enable clients to securely call protected web APIs, and are used by web APIs to perform authentication and authorization.</span></span> <span data-ttu-id="06b37-108">OAuth 仕様によると、アクセス トークンは、設定された形式を持たない不透明な文字列です。ID プロバイダー (IDP) によっては、GUID を使用するものもあれば、暗号化された BLOB を使用するものもあります。</span><span class="sxs-lookup"><span data-stu-id="06b37-108">As per the OAuth specification, access tokens are opaque strings without a set format - some identity providers (IDPs) use GUIDs, others use encrypted blobs.</span></span> <span data-ttu-id="06b37-109">Microsoft ID プラットフォームでは、トークンを受け入れる API の構成に応じて、さまざまなアクセス トークン形式が使用されます。</span><span class="sxs-lookup"><span data-stu-id="06b37-109">The Microsoft identity platform uses a variety of access token formats, depending on the configuration of the API that accepts the token.</span></span> <span data-ttu-id="06b37-110">API がアクセス トークン内のクレームを検証および使用する方法については、「[Microsoft ID プラットフォームのアクセス トークン](https://docs.microsoft.com/azure/active-directory/develop/userinfo#calling-the-userinfo-endpoint)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="06b37-110">To learn how your API can validate and use the claims inside an access token, see [Microsoft identity platform access tokens](https://docs.microsoft.com/azure/active-directory/develop/userinfo#calling-the-userinfo-endpoint).</span></span>
3. <span data-ttu-id="06b37-111">Microsoft Authentication Library (MSAL) は、さまざまなアプリケーション シナリオで使用する複数の認証フローをサポートします。</span><span class="sxs-lookup"><span data-stu-id="06b37-111">The Microsoft Authentication Library (MSAL) supports several authentication flows for use in different application scenarios.</span></span> <span data-ttu-id="06b37-112">詳細については、「[認証フロー](https://docs.microsoft.com/azure/active-directory/develop/msal-authentication-flows#how-each-flow-emits-tokens-and-codes)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="06b37-112">For more information, see [Authentication flows](https://docs.microsoft.com/azure/active-directory/develop/msal-authentication-flows#how-each-flow-emits-tokens-and-codes).</span></span>
4. <span data-ttu-id="06b37-113">OAuth 2.0 認証コード付与は、デバイスにインストールされているアプリで、Web API などの保護されたリソースにアクセスするために使用できます。</span><span class="sxs-lookup"><span data-stu-id="06b37-113">The OAuth 2.0 authorization code grant can be used in apps that are installed on a device to gain access to protected resources, such as web APIs.</span></span> <span data-ttu-id="06b37-114">OAuth 2.0 の Microsoft ID プラットフォームの実装を使用すると、モバイル アプリおよびデスクトップ アプリにサインインおよび API アクセスを追加できます。</span><span class="sxs-lookup"><span data-stu-id="06b37-114">Using the Microsoft identity platform implementation of OAuth 2.0, you can add sign-in and API access to your mobile and desktop apps.</span></span> <span data-ttu-id="06b37-115">任意の言語を使用して、アプリケーションのプロトコルに対して直接プログラミングする方法については、「[Microsoft ID プラットフォームおよび OAuth 2.0 認証コードのフロー](https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-auth-code-flow#refresh-the-access-token)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="06b37-115">See [Microsoft identity platform and OAuth 2.0 authorization code flow](https://docs.microsoft.com/azure/active-directory/develop/v2-oauth2-auth-code-flow#refresh-the-access-token) for how to program directly against the protocol in your application, using any language.</span></span>
5. <span data-ttu-id="06b37-116">OpenID Connect (OIDC) は、OAuth 2.0 上に構築された認証プロトコルで、ユーザーをアプリケーションに安全にサインインするために使用できます。</span><span class="sxs-lookup"><span data-stu-id="06b37-116">OpenID Connect (OIDC) is an authentication protocol built on OAuth 2.0 that you can use to securely sign in a user to an application.</span></span> <span data-ttu-id="06b37-117">Microsoft ID プラットフォーム エンドポイントの OpenID Connect の実装を使用する場合、アプリにサインインと API アクセスを追加できます。</span><span class="sxs-lookup"><span data-stu-id="06b37-117">When you use the Microsoft identity platform endpoint's implementation of OpenID Connect, you can add sign-in and API access to your apps.</span></span> <span data-ttu-id="06b37-118">[Microsoft ID プラットフォームおよび OpenID Connect プロトコル](https://docs.microsoft.com/azure/active-directory/develop/v2-protocols-oidc#send-the-sign-in-request)は、言語に依存せずに実行する方法を示し、Microsoft オープンソース ライブラリを使用せずに HTTP メッセージを送受信する方法を説明します。</span><span class="sxs-lookup"><span data-stu-id="06b37-118">[Microsoft identity platform and OpenID Connect protocol](https://docs.microsoft.com/azure/active-directory/develop/v2-protocols-oidc#send-the-sign-in-request) shows how to do this independent of language and describes how to send and receive HTTP messages without using any Microsoft open-source libraries.</span></span>
    - <span data-ttu-id="06b37-119">UserInfo エンドポイントは OIDC 標準の一部であり、認証されたユーザーに関する要求を返すように設計されています。</span><span class="sxs-lookup"><span data-stu-id="06b37-119">The UserInfo endpoint is part of the OIDC standard, designed to return claims about the user that authenticated.</span></span> <span data-ttu-id="06b37-120">詳細については、「[Microsoft ID プラットフォームの UserInfo エンドポイント](https://docs.microsoft.com/azure/active-directory/develop/userinfo#consider-use-an-id-token-instead)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="06b37-120">For more information, see [Microsoft identity platform UserInfo endpoint](https://docs.microsoft.com/azure/active-directory/develop/userinfo#consider-use-an-id-token-instead).</span></span>
    - <span data-ttu-id="06b37-121">[Azure AD と OpenID Connect を使用した Web アプリの Web API の呼び出し](https://docs.microsoft.com/samples/azure-samples/active-directory-dotnet-webapp-webapi-openidconnect/active-directory-dotnet-webapp-webapi-openidconnect/)サンプルは、OpenID Connect プロトコルを使用して Azure AD でサインインする MVC Web アプリケーションを作成し、OAuth 2.0 経由で入手したトークンを使用してサインインしたユーザーの ID で Web API を呼び出す方法を示します。</span><span class="sxs-lookup"><span data-stu-id="06b37-121">The [Calling a web API in a web app using Azure AD and OpenID Connect](https://docs.microsoft.com/samples/azure-samples/active-directory-dotnet-webapp-webapi-openidconnect/active-directory-dotnet-webapp-webapi-openidconnect/) sample shows how to build an MVC web application that uses Azure AD for sign-in using the OpenID Connect protocol, and then call a web API under the signed-in user's identity using tokens obtained via OAuth 2.0.</span></span> <span data-ttu-id="06b37-122">このサンプルは、OpenID Connect ASP .Net OWIN ミドルウェアと ADAL .Net を使用します。</span><span class="sxs-lookup"><span data-stu-id="06b37-122">This sample uses the OpenID Connect ASP .Net OWIN middleware and ADAL .Net.</span></span>
6. <span data-ttu-id="06b37-123">[アプリケーションで Web API を公開するように構成する](https://docs.microsoft.com/azure/active-directory/develop/quickstart-configure-app-expose-web-apis) - このクイックスタートでは、Microsoft ID プラットフォームに Web API を登録し、サンプル範囲を追加してクライアント アプリに公開します。</span><span class="sxs-lookup"><span data-stu-id="06b37-123">[Configure an application to expose a web API](https://docs.microsoft.com/azure/active-directory/develop/quickstart-configure-app-expose-web-apis) - In this quickstart, you register a web API with the Microsoft identity platform and expose it to client apps by adding an example scope.</span></span> <span data-ttu-id="06b37-124">Web API を登録し、範囲を介して公開することにより、認証されたユーザーおよび API にアクセスするクライアント アプリに対してリソースへのアクセス許可ベースのアクセスを提供できます。</span><span class="sxs-lookup"><span data-stu-id="06b37-124">By registering your web API and exposing it through scopes, you can provide permissions-based access to its resources to authorized users and client apps that access your API.</span></span>
7. <span data-ttu-id="06b37-125">Azure Active Directory B2C (Azure AD B2C) では、リソース所有者パスワード資格情報 (ROPC) フローは OAuth 標準認証フローです。</span><span class="sxs-lookup"><span data-stu-id="06b37-125">In Azure Active Directory B2C (Azure AD B2C), the resource owner password credentials (ROPC) flow is an OAuth standard authentication flow.</span></span> <span data-ttu-id="06b37-126">このフローでは、アプリケーション (証明書利用者とも呼ばれる) がトークンの有効な資格情報を交換します。</span><span class="sxs-lookup"><span data-stu-id="06b37-126">In this flow, an application, also known as the relying party, exchanges valid credentials for tokens.</span></span> <span data-ttu-id="06b37-127">資格情報には、ユーザー ID とパスワードが含まれます。</span><span class="sxs-lookup"><span data-stu-id="06b37-127">The credentials include a user ID and password.</span></span> <span data-ttu-id="06b37-128">返されるトークンは、ID トークン、アクセス トークン、および更新トークンです。</span><span class="sxs-lookup"><span data-stu-id="06b37-128">The tokens returned are an ID token, access token, and a refresh token.</span></span> <span data-ttu-id="06b37-129">詳細については、「[Azure Active Directory B2C でリソース所有者のパスワード資格情報フローをセットアップする](https://docs.microsoft.com/azure/active-directory-b2c/add-ropc-policy?tabs=app-reg-ga&pivots=b2c-user-flow)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="06b37-129">For more information, see [Set up a resource owner password credentials flow in Azure Active Directory B2C](https://docs.microsoft.com/azure/active-directory-b2c/add-ropc-policy?tabs=app-reg-ga&pivots=b2c-user-flow).</span></span> 

